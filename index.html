<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Neon Ashes Companion</title>

<style>
body { margin:0; font-family:Arial; background:#e7e1d6; color:#2c2c2c; }

header { background:#6b5b4d; color:white; padding:1rem; text-align:center; }

#menuBtn { position:fixed; top:10px; right:10px; font-size:24px; cursor:pointer; }

#menuPanel {
  position:fixed;
  top:50px;
  right:10px;
  background:#f4efe6;
  border-radius:8px;
  padding:10px;
  display:none;
  box-shadow:0 2px 10px rgba(0,0,0,0.2);
  z-index:999;
}

#menuPanel button { display:block; width:100%; margin:5px 0; }

#confirmModal {
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.5);
  display:none;
  align-items:center;
  justify-content:center;
  z-index:9999;
}

#confirmBox {
  background:#f4efe6;
  padding:20px;
  border-radius:8px;
  text-align:center;
}

#fuelContainer {
  position:fixed;
  bottom:10px;
  right:10px;
  font-size:22px;
  display:flex;
  gap:5px;
}

.fuel-loss {
  position:absolute;
  color:#a23e2e;
  font-weight:bold;
  font-size:28px;
  animation:floatDown 0.9s ease forwards;
}

@keyframes floatDown {
  0% {opacity:1; transform:translateY(-10px);}
  100% {opacity:0; transform:translateY(25px);}
}

.fuel-flash { color:#a23e2e; transition:color 0.3s; }

#map { position:relative; width:100%; max-width:600px; margin:auto; }

#mapBackground { width:100%; border-radius:8px; }

.node {
  position:absolute;
  width:18px;
  height:18px;
  background:#8c7b6a;
  border-radius:50%;
  transform:translate(-50%,-50%);
  cursor:pointer;
}

.node.active {
  background:#a23e2e;
  box-shadow:0 0 12px rgba(162,62,46,0.9);
}

.nodeLabel {
  position:absolute;
  bottom:22px;
  left:50%;
  transform:translateX(-50%);
  background:white;
  padding:2px 6px;
  font-size:10px;
  border-radius:4px;
  pointer-events:none;
}

#playerCar {
  position:absolute;
  width:14px;
  height:14px;
  background:#a23e2e;
  border-radius:50%;
  transform:translate(-50%,-50%);
  transition:all 0.8s ease-in-out;
}

#playerCar::after {
  content:"";
  position:absolute;
  width:28px;
  height:28px;
  background:rgba(162,62,46,0.25);
  border-radius:50%;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  z-index:-1;
  animation:pulse 2s infinite;
}

@keyframes pulse {
  0% { transform:translate(-50%,-50%) scale(0.6); opacity:0.7; }
  50% { transform:translate(-50%,-50%) scale(1); opacity:0.2; }
  100% { transform:translate(-50%,-50%) scale(0.6); opacity:0.7; }
}

#nodePopup {
  position:absolute;
  background:white;
  padding:8px;
  border-radius:6px;
  box-shadow:0 2px 6px rgba(0,0,0,0.3);
  font-size:12px;
  display:none;
  transform:translate(-50%,-120%);
  z-index:5;
}

#nodePopup button {
  margin-top:5px;
  width:100%;
  font-size:12px;
  background:#6b5b4d;
  color:white;
  border:none;
  padding:4px;
  border-radius:4px;
}
</style>
</head>

<body>

<header>NEW RUSTVILLE â€“ CAMPAIGN MAP</header>

<div id="menuBtn" onclick="toggleMenu()">â˜°</div>

<div id="menuPanel">
<button onclick="showConfirm()">New Game</button>
<button onclick="downloadSave()">Download Save</button>
<input type="file" id="uploadSave" style="display:none" onchange="loadSave(event)">
<button onclick="document.getElementById('uploadSave').click()">Upload Save</button>
</div>

<div id="confirmModal">
<div id="confirmBox">
<p>All unsaved progress will be lost.</p>
<button onclick="newGame()">OK</button>
<button onclick="hideConfirm()">Cancel</button>
</div>
</div>

<div id="fuelContainer">ðŸ›¢ <span id="fuel">11</span></div>

<div id="map">

<img src="map.png" id="mapBackground">

<div class="node" style="left:44%;top:60%"><div class="nodeLabel">Garage Ruins</div></div>
<div class="node" style="left:25%;top:35%"><div class="nodeLabel">Industrial Strip</div></div>
<div class="node" style="left:70%;top:35%"><div class="nodeLabel">Spiral Parking Deck</div></div>
<div class="node" style="left:50%;top:45%"><div class="nodeLabel">Downtown Skeleton</div></div>
<div class="node" style="left:50%;top:80%"><div class="nodeLabel">Fuel Yard</div></div>

<div id="playerCar"></div>

<div id="nodePopup">
<div id="popupTitle"></div>
<div id="popupDesc"></div>
<div id="popupRaces"></div>
<button id="travelBtn"></button>
</div>

</div>

<script>

let saveData = { fuel:11, locationIndex:0 };

const nodes = document.querySelectorAll(".node");
const car = document.getElementById("playerCar");
const fuelText = document.getElementById("fuel");

const popup = document.getElementById("nodePopup");
const popupTitle = document.getElementById("popupTitle");
const popupDesc = document.getElementById("popupDesc");
const popupRaces = document.getElementById("popupRaces");
const travelBtn = document.getElementById("travelBtn");

const locationData = [
{ name:"Garage Ruins", desc:"Your safehouse.", races:["None"] },
{ name:"Industrial Strip", desc:"Rust factories.", races:["Sprint"] },
{ name:"Spiral Parking Deck", desc:"Perfect drift arena.", races:["Drift Race"] },
{ name:"Downtown Skeleton", desc:"Collapsed streets.", races:["Endurance"] },
{ name:"Fuel Yard", desc:"Trade hub.", races:["Heist"] }
];

loadLocal();
moveCar(nodes[saveData.locationIndex]);
setActiveNode(saveData.locationIndex);

nodes.forEach((n,i)=> n.onclick=(e)=>showPopup(i,n));

function showPopup(index,node){
const data = locationData[index];
popupTitle.textContent=data.name;
popupDesc.textContent=data.desc;
popupRaces.textContent="Race: "+data.races.join(", ");
travelBtn.innerHTML="Travel (-1 ðŸ›¢)";
travelBtn.onclick=()=>travelTo(index);
popup.style.display="block";
popup.style.left=node.style.left;
popup.style.top=node.style.top;
}

function travelTo(index){
if(saveData.fuel<=0) return alert("Out of fuel!");
popup.style.display="none";
saveData.fuel--;
animateFuelLoss(1);
saveData.locationIndex=index;
setActiveNode(index);
updateUI();
moveCar(nodes[index]);
saveLocal();
}

function setActiveNode(index){
nodes.forEach(n=>n.classList.remove("active"));
nodes[index].classList.add("active");
}

function moveCar(node){
car.style.left=node.style.left;
car.style.top=node.style.top;
}

function updateUI(){ fuelText.textContent=saveData.fuel; }

function animateFuelLoss(amount){
const container=document.getElementById("fuelContainer");
const loss=document.createElement("div");
loss.textContent="-"+amount;
loss.className="fuel-loss";
container.appendChild(loss);
setTimeout(()=>loss.remove(),900);
fuelText.classList.add("fuel-flash");
setTimeout(()=>fuelText.classList.remove("fuel-flash"),300);
}

function saveLocal(){ localStorage.setItem("neonAshesSave",JSON.stringify(saveData)); }

function loadLocal(){
const data=localStorage.getItem("neonAshesSave");
if(data) saveData=JSON.parse(data);
updateUI();
}

function downloadSave(){
const blob=new Blob([JSON.stringify(saveData)],{type:"application/json"});
const a=document.createElement("a");
a.href=URL.createObjectURL(blob);
a.download="neon_ashes_save.json";
a.click();
}

function loadSave(event){
const file=event.target.files[0];
const reader=new FileReader();
reader.onload=function(e){
saveData=JSON.parse(e.target.result);
updateUI();
moveCar(nodes[saveData.locationIndex]);
setActiveNode(saveData.locationIndex);
saveLocal();
};
reader.readAsText(file);
}

function toggleMenu(){
const panel=document.getElementById("menuPanel");
panel.style.display=panel.style.display==="block"?"none":"block";
}

function showConfirm(){ document.getElementById("confirmModal").style.display="flex"; }
function hideConfirm(){ document.getElementById("confirmModal").style.display="none"; }
function newGame(){ localStorage.removeItem("neonAshesSave"); location.reload(); }

</script>
</body>
</html>
